#macro(contacts_content)
    <h3>Contacts</h3>
    <div>
        <button onclick="pullContacts();">List contacts</button>
        <button onclick="toggleAddContactContainer();">Add contact</button>
    </div>

    <div id="add-contact-container"></div>
    <div id="contact-list-container"></div>

    <script>
        let showAddContactContainer = localStorage["showAddContactContainer"] || false;
        localStorage["showAddContactContainer"] = showAddContactContainer;

        $("#add-contact-container").replaceWith(generateContactItem(
                "id=\"add-contact-container\"", "", "", "", "addContact()", "Submit"
        ));
        let addContactContainer = $("#add-contact-container");
        let contactListContainer = $("#contact-list-container");

        let addContactFirstName   = addContactContainer.children(".contact-first-name");
        let addContactMiddleNames = addContactContainer.children(".contact-middle-names");
        let addContactLastName    = addContactContainer.children(".contact-last-name");
        let addContactSubmit      = addContactContainer.children(".contact-submit");

        updateAddContactContainer();

        addContactContainer.children("input").on("change", function() {
            addContactSubmit.prop("disabled", addContactFirstName.val() === "");
            console.log(addContactSubmit.prop("disabled"));
        });

        function generateContactItem(container, firstName, middleNames, lastName, onclick, buttonLabel) {
            container   = (typeof container   === "undefined") ? "" : container;
            firstName   = (typeof firstName   === "undefined") ? "" : firstName;
            middleNames = (typeof middleNames === "undefined") ? "" : middleNames;
            lastName    = (typeof lastName    === "undefined") ? "" : lastName;
            onclick     = (typeof onclick     === "undefined") ? "" : onclick;
            buttonLabel = (typeof buttonLabel === "undefined") ? "" : buttonLabel;
            return `<div ${container}>
                        <label for="contact-first-name">First Name</label>
                        <input type="text" id="contact-first-name" class="contact-first-name" value="${firstName}" />
                        <label for="contact-middle-names">Middle Names</label>
                        <input type="text" id="contact-middle-names" class="contact-middle-names" value="${middleNames}" />
                        <label for="contact-last-name">Last Name</label>
                        <input type="text" id="contact-last-name" class="contact-last-name" value="${lastName}" />

                        <button id="add-contact-submit" class="btn" onclick="${onclick}">${buttonLabel}</button>
                    </div>`;
        }

        function validateContact() {
            let isValid = true;
            isValid &= addContactFirstName.val() !== "";
            return isValid;
        }

        function pullContacts() {
            runAjax("post", "/get_contacts", null, function() {
                let response = JSON.parse(this.response);
                contactListContainer.empty();
                response.forEach(function(contact) {
                    contactListContainer.append(generateContactItem(
                        "class=\"contact-list-item\"", contact.firstName, contact.middleNames, contact.lastName, "updateContact()", "Update"
                    ));
                })
            });
        }

        function addContact() {
            if (validateContact()) {
                let data = JSON.stringify({
                    "firstName": addContactFirstName.val(),
                    "middleNames": addContactMiddleNames.val(),
                    "lastName": addContactLastName.val(),
                });
                runAjax("post", "/add_contact", data, function() {
                    let response = JSON.parse(this.response);
                    if (response["success"]) {
                        console.log("Contact added");
                    } else {
                        console.log("Failed to add contact");
                    }
                });
            }
        }

        function updateContact() {

        }

        function toggleAddContactContainer() {
            showAddContactContainer = !showAddContactContainer;
            localStorage["showAddContact"] = showAddContactContainer;
            updateAddContactContainer();
        }
        function updateAddContactContainer() {
            if (showAddContactContainer)
                addContactContainer.show();
            else
                addContactContainer.hide();
        }
    </script>
#end
